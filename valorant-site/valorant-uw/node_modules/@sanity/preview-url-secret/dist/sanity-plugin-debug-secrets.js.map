{"version":3,"file":"sanity-plugin-debug-secrets.js","sources":["../src/sanityPluginDebugSecrets/debugUrlSecrets.tsx","../src/sanityPluginDebugSecrets/index.ts"],"sourcesContent":["import {CheckmarkCircleIcon, CloseCircleIcon, LockIcon} from '@sanity/icons'\nimport {defineType} from 'sanity'\nimport {schemaType, SECRET_TTL} from '../constants'\n\nexport const debugUrlSecretsType = defineType({\n  type: 'document',\n  icon: LockIcon,\n  name: schemaType,\n  title: '@sanity/preview-url-secret',\n  readOnly: true,\n  fields: [\n    {\n      type: 'string',\n      name: 'secret',\n      title: 'Secret',\n    },\n    {\n      type: 'string',\n      name: 'source',\n      title: 'Source Tool',\n    },\n    {\n      type: 'string',\n      name: 'studioUrl',\n      title: 'Studio URL',\n    },\n    {\n      type: 'string',\n      name: 'userId',\n      title: 'Sanity User ID',\n    },\n  ],\n  preview: {\n    select: {\n      source: 'source',\n      studioUrl: 'studioUrl',\n      updatedAt: '_updatedAt',\n    },\n    prepare(data) {\n      const url = data.studioUrl ? new URL(data.studioUrl, location.origin) : undefined\n      const updatedAt = new Date(data.updatedAt).getTime()\n      const expiresAt = new Date(updatedAt + 1000 * SECRET_TTL)\n      const expired = expiresAt < new Date()\n      const icon = expired ? CloseCircleIcon : CheckmarkCircleIcon\n      return {\n        title: url ? `${url.host}${url.pathname}` : data.source,\n        subtitle: expired\n          ? 'Expired'\n          : `Expires in ${Math.round((expiresAt.getTime() - Date.now()) / (1000 * 60))} minutes`,\n        media: icon,\n      }\n    },\n  },\n})\n","import {definePlugin} from 'sanity'\nimport {schemaType} from '../constants'\nimport {debugUrlSecretsType} from './debugUrlSecrets'\n\nexport const debugSecrets = definePlugin<void>(() => {\n  return {\n    name: 'sanity-plugin-debug-secrets',\n    schema: {\n      types: [debugUrlSecretsType],\n    },\n    document: {\n      actions: (prev, context) => {\n        if (context.schemaType !== schemaType) {\n          return prev\n        }\n        return prev.filter(({action}) => action === 'delete')\n      },\n      inspectors: (prev, context) => {\n        if (context.documentType !== schemaType) {\n          return prev\n        }\n        return []\n      },\n      unstable_fieldActions: (prev, context) => {\n        if (context.schemaType.name !== schemaType) {\n          return prev\n        }\n        return []\n      },\n    },\n  }\n})\n"],"names":[],"mappings":";;;AAIO,MAAM,sBAAsB,WAAW;AAAA,EAC5C,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,UAAU;AAAA,EACV,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IAAA;AAAA,EAEX;AAAA,EACA,SAAS;AAAA,IACP,QAAQ;AAAA,MACN,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,WAAW;AAAA,IACb;AAAA,IACA,QAAQ,MAAM;AACZ,YAAM,MAAM,KAAK,YAAY,IAAI,IAAI,KAAK,WAAW,SAAS,MAAM,IAAI,QAClE,YAAY,IAAI,KAAK,KAAK,SAAS,EAAE,QACrC,GAAA,YAAY,IAAI,KAAK,YAAY,MAAO,UAAU,GAClD,UAAU,YAAgB,oBAAA,KAC1B,GAAA,OAAO,UAAU,kBAAkB;AAClC,aAAA;AAAA,QACL,OAAO,MAAM,GAAG,IAAI,IAAI,GAAG,IAAI,QAAQ,KAAK,KAAK;AAAA,QACjD,UAAU,UACN,YACA,cAAc,KAAK,OAAO,UAAU,QAAQ,IAAI,KAAK,IAAU,MAAA,MAAO,GAAG,CAAC;AAAA,QAC9E,OAAO;AAAA,MACT;AAAA,IAAA;AAAA,EACF;AAEJ,CAAC,GCjDY,eAAe,aAAmB,OACtC;AAAA,EACL,MAAM;AAAA,EACN,QAAQ;AAAA,IACN,OAAO,CAAC,mBAAmB;AAAA,EAC7B;AAAA,EACA,UAAU;AAAA,IACR,SAAS,CAAC,MAAM,YACV,QAAQ,eAAe,aAClB,OAEF,KAAK,OAAO,CAAC,EAAC,OAAM,MAAM,WAAW,QAAQ;AAAA,IAEtD,YAAY,CAAC,MAAM,YACb,QAAQ,iBAAiB,aACpB,OAEF,CAAC;AAAA,IAEV,uBAAuB,CAAC,MAAM,YACxB,QAAQ,WAAW,SAAS,aACvB,OAEF,CAAA;AAAA,EAAC;AAGd,EACD;"}