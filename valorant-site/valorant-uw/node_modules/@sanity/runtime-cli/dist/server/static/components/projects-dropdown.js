/* globals customElements */
import {ApiBaseElement} from './api-base.js'

const template = `<fieldset class="mar-t-sm">
    <label>Project</label>
    <select id="project">
    </select>
</fieldset>
`

class ProjectsDropdown extends ApiBaseElement {
  projectSelected = (event) => {
    this.api.store.selectedProject = event.srcElement.value
  }
  renderProjects = () => {
    if (this.api.store.projects.length > 0) {
      this.select.innerHTML = this.api.store.projects
        .map((proj) => {
          const selected = this.api.store.selectedProject === proj.id ? 'selected' : ''
          return `<option value="${proj.id}" ${selected}>${proj.displayName}</option>`
        })
        .join('')
    } else {
      this.select.innerHTML = '<option>No Projects found</option>'
    }
  }

  connectedCallback() {
    this.innerHTML = template
    this.select = this.querySelector('select')
    this.select.addEventListener('change', this.projectSelected)
    this.api.subscribe(this.renderProjects, ['projects'])
    this.api.projects()
  }

  disconnectedCallback() {
    this.select.removeEventListener('change', this.projectSelected)
    this.api.unsubscribe(this.renderProjects)
  }
}

customElements.define('projects-dropdown', ProjectsDropdown)
