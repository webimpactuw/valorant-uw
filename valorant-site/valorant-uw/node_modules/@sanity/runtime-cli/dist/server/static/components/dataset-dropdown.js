/* globals customElements */
import {ApiBaseElement} from './api-base.js'

const template = `<fieldset class="mar-t-sm">
    <label>Dataset</label>
    <select id="dataset">
    </select>
</fieldset>
`

class DatasetDropdown extends ApiBaseElement {
  datasetSelected = (event) => {
    this.api.store.selectedDataset = event.srcElement.value
  }
  renderDatasets = () => {
    if (this.api.store?.datasets?.length > 0) {
      this.select.innerHTML = this.api.store.datasets
        .map((dataset) => {
          const selected = this.api.store.selectedDataset === dataset.name ? 'selected' : ''
          return `<option value="${dataset.name}" ${selected}>${dataset.name}</option>`
        })
        .join('')
    } else {
      this.select.innerHTML = '<option>No Datasets found</option>'
    }
  }
  queryDatasets = () => {
    this.api.datasets(this.api.store.selectedProject)
  }

  connectedCallback() {
    this.innerHTML = template
    this.select = this.querySelector('select')
    this.select.addEventListener('change', this.datasetSelected)
    this.api.subscribe(this.renderDatasets, ['datasets'])
    this.api.subscribe(this.queryDatasets, ['selectedProject'])
  }

  disconnectedCallback() {
    this.select.removeEventListener('change', this.datasetSelected)
    this.api.unsubscribe(this.renderProjects)
  }
}

customElements.define('dataset-dropdown', DatasetDropdown)
